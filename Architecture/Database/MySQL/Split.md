# 切分

## 水平切分

* Sharding
* 结构不变，按行拆分

## 垂直切分

* 按列拆分

---

## Sharding 策略

* 哈希取模： hash(key) % N
* 范围：ID 范围 / 时间范围 
* 映射表：使用单独库存储映射关系

## Sharding 问题

* 事务
    * 分布式事务
        * 如 XA 接口
* 连接
    * 将原连接分解成多个单表查询
    * 在用户程序中连接
* ID 唯一性
    * 全局唯一 ID （GUID）
    * 每个分片指定一个 ID 范围
    * 分布式 ID 生成器
        * Twitter - Snowflake

---

## 复制

### 主从复制

* binlog 线程
    * 将主服务器的数据变更写入二进制日志
* IO 线程
    * 从主服务器读取 binlog，写入从服务器的中继日志 relay log
* SQL 线程
    * 读取中继日志，解析数据变更，在从服务器中重放

### 读写分离

#### 分工

* 主服务器处理写操作、以及实时性要求高的读操作
* 从服务器处理读操作

#### 分析

* 主从读写分离，缓解锁争用
* 从服务器可以使用 MyISAM
    * 提升查询性能
    * 节省系统开销
* 增加冗余，提高可用性

#### 实现

* 代理
    * 查询请求发往代理服务器
    * 代理服务器决定转发给谁

---
